<div class="content" data-catalog-page="admin">
  <aside class="sidebar side-rail">
    <a class="side-icon" href="#hero-banner" title="Featured spotlight">
      <i class="fa-solid fa-bolt"></i>
    </a>
    <% if (user && user.isAdmin) { %>
      <a class="side-icon" href="/movies/add" title="Add movie">
        <i class="fa-solid fa-plus"></i>
      </a>
    <% } %>
    <a class="side-icon <%= activePlatform ? '' : 'active' %>" href="/" title="Home">
      <i class="fa-solid fa-house"></i>
    </a>
    <% if (user && user.isAdmin) { %>
      <a class="side-icon" href="/admin/films" title="Analytics board">
        <i class="fa-solid fa-chart-line"></i>
      </a>
    <% } %>
    <a class="side-icon" href="#platform-row" title="Browse platforms">
      <i class="fa-solid fa-layer-group"></i>
    </a>
    <a class="side-icon" href="#platform-gallery" title="Stream catalog">
      <i class="fa-solid fa-clapperboard"></i>
    </a>
    <a class="side-icon" href="/platform/netflix" title="Netflix">
      <i class="fa-solid fa-ticket"></i>
    </a>
    <a class="side-icon" href="/platform/disney%2B" title="Disney+">
      <i class="fa-regular fa-heart"></i>
    </a>
    <a class="side-icon" href="/platform/prime%20video" title="Prime Video">
      <i class="fa-regular fa-user"></i>
    </a>
  </aside>

  <section class="hero-section">
    <div class="hero-panel hero-shell" id="hero-banner" data-hero-shell>
      <div class="hero-panel__image" data-hero-image></div>
      <div class="hero-panel__glow"></div>
      <div class="hero-content">
        <div class="hero-left">
          <p class="platform-label" data-hero-source>NETFLIX</p>
          <h1 class="hero-title" data-hero-title>Bodies</h1>
          <div class="meta-row">
            <span class="badge imdb">
              <i class="fa-solid fa-star"></i>
              <span data-hero-imdb>IMDb 0.0</span>
            </span>
            <span class="badge" data-hero-runtime>—</span>
            <span class="badge" data-hero-year>—</span>
            <span class="badge" data-hero-rating>18+</span>
          </div>
          <p class="hero-description" data-hero-description>
            Start adding movies to populate this hero panel.
          </p>
          <div class="genres hero-tags" data-hero-tags>
            <span class="genre-pill tag-pill">Crime</span>
            <span class="genre-pill tag-pill">Drama</span>
            <span class="genre-pill tag-pill">History</span>
          </div>
          <div class="hero-actions">
            <button class="btn btn-primary" type="button" data-hero-modal>
              <i class="fa-solid fa-play"></i> Watch Now
            </button>
            <button class="btn btn-secondary" type="button" data-hero-save>
              <i class="fa-solid fa-bookmark"></i> Watchlist
            </button>
          </div>
        </div>
        <div class="hero-right hero-poster">
          <div class="poster-card">
            <img data-hero-poster src="https://placehold.co/200x320/111/eee?text=Poster" alt="Featured poster">
            <div class="poster-dots" data-hero-dots></div>
            <button class="poster-speaker poster-sound" type="button">
              <i class="fa-solid fa-volume-high"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <% const fallbackPlatforms = ['Netflix','Prime Video','Disney+','HBO Max','Apple TV+','Vidio','Viu','Hulu','Paramount+','Peacock']; %>
    <% const providerSource = (platforms && platforms.length ? platforms : fallbackPlatforms); %>
    <% const providerLogoMap = {
         'netflix': { src: '/img/platforms/netflix.svg' },
         'disney+': { src: '/img/platforms/disney-plus.svg' },
         'prime video': { src: '/img/platforms/prime-video.svg' },
         'primevideo': { src: '/img/platforms/prime-video.svg' },
         'vidio': { src: '/img/platforms/vidio.svg' },
         'apple tv+': { src: '/img/platforms/apple-tv-plus.png', tint: true },
         'apple tv plus': { src: '/img/platforms/apple-tv-plus.png', tint: true },
         'viu': { src: '/img/platforms/viu.svg' },
         'hbo max': { src: 'https://upload.wikimedia.org/wikipedia/commons/1/17/HBO_Max_2020.svg', tint: true },
         'hulu': { src: 'https://upload.wikimedia.org/wikipedia/commons/e/e4/Hulu_Logo.svg', tint: true },
         'paramount+': { src: 'https://upload.wikimedia.org/wikipedia/commons/8/88/Paramount%2B_logo.svg', tint: true },
         'paramount plus': { src: 'https://upload.wikimedia.org/wikipedia/commons/8/88/Paramount%2B_logo.svg', tint: true },
         'peacock': { src: 'https://upload.wikimedia.org/wikipedia/commons/8/88/Peacock_logo_2020.svg', tint: true }
       }; %>
    <% const providerList = ['All', ...providerSource]; %>
    <% const tabList = providerList.slice(0, 3); %>
    <% const curatedSections = sections || {}; %>

    <div class="tabs" id="platform-tabs">
      <% tabList.forEach(name => {
           const slug = encodeURIComponent(name.toLowerCase());
           const isAll = name.toLowerCase() === 'all';
           const isActive = isAll ? !activePlatform : activePlatform === name.toLowerCase();
           const href = isAll ? '/' : ('/platform/' + slug);
      %>
        <a class="tab-btn <%= isActive ? 'active' : '' %>" href="<%= href %>"><%= name %></a>
      <% }) %>
    </div>

    <% const defaultSlugList = ['netflix','disney+','prime video','vidio','apple tv+','viu','hbo','hulu','paramount+','peacock']; %>
    <% const allowedSlugSet = new Set((allowedPlatformSlugs && allowedPlatformSlugs.length ? allowedPlatformSlugs : defaultSlugList)); %>

    <section class="streaming-platform-row" id="platform-row">
      <% if (allowedSlugSet.has('netflix')) { %>
        <a class="stream-card <%= activePlatform === 'netflix' ? 'is-active' : '' %>" href="/platform/netflix">
          <span class="logo netflix">NETFLIX</span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('disney+')) { %>
        <a class="stream-card <%= activePlatform === 'disney+' ? 'is-active' : '' %>" href="/platform/disney%2B">
          <span class="logo disney">Disney<span>+</span></span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('prime video')) { %>
        <a class="stream-card <%= activePlatform === 'prime video' ? 'is-active' : '' %>" href="/platform/prime%20video">
          <span class="logo prime">prime<span> video</span><i></i></span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('vidio')) { %>
        <a class="stream-card <%= activePlatform === 'vidio' ? 'is-active' : '' %>" href="/platform/vidio">
          <span class="logo vidio">Vidio</span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('apple tv+')) { %>
        <a class="stream-card <%= activePlatform === 'apple tv+' ? 'is-active' : '' %>" href="/platform/apple%20tv%2B">
          <span class="logo apple"><i></i><span>tv+</span></span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('viu')) { %>
        <a class="stream-card <%= activePlatform === 'viu' ? 'is-active' : '' %>" href="/platform/viu">
          <span class="logo viu"><i></i><span>viu</span></span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('hbo')) { %>
        <a class="stream-card <%= activePlatform === 'hbo' ? 'is-active' : '' %>" href="/platform/hbo">
          <span class="logo">HBO</span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('hulu')) { %>
        <a class="stream-card <%= activePlatform === 'hulu' ? 'is-active' : '' %>" href="/platform/hulu">
          <span class="logo">hulu</span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('paramount+')) { %>
        <a class="stream-card <%= activePlatform === 'paramount+' ? 'is-active' : '' %>" href="/platform/paramount%2B">
          <span class="logo">Paramount+</span>
        </a>
      <% } %>
      <% if (allowedSlugSet.has('peacock')) { %>
        <a class="stream-card <%= activePlatform === 'peacock' ? 'is-active' : '' %>" href="/platform/peacock">
          <span class="logo">Peacock</span>
        </a>
      <% } %>
    </section>

    <div class="insight-row">
      <div class="insight-card">
        <p class="label">Total catalog</p>
        <strong><%= stats.totalMovies || 0 %> titles</strong>
      </div>
      <div class="insight-card">
        <p class="label">Active platforms</p>
        <strong><%= stats.platformCount || 0 %></strong>
      </div>
      <div class="insight-card">
        <p class="label">Spotlight</p>
        <strong><%= platformLabel %></strong>
        <p class="helper-text"><%= stats.visibleTitles %> titles curated</p>
      </div>
      <div class="insight-card">
        <p class="label">Avg. rating</p>
        <strong><%= stats.averageRating || '0.0' %></strong>
      </div>
      <% if (!user || !user.isAdmin) { %>
        <div class="insight-card">
          <p class="label">Plan</p>
          <strong><%= planInfo ? planInfo.name : 'Free' %></strong>
          <p class="helper-text"><%= (allowedPlatforms || []).length %> platforms unlocked</p>
        </div>
      <% } %>
    </div>

    <% const nextPlatform = activePlatform || (providerSource[0] ? providerSource[0].toLowerCase() : ''); %>
    <% const catalogLink = nextPlatform ? ('/platform/' + encodeURIComponent(nextPlatform) + '/catalog') : '/movies/add'; %>

    <section class="spotlight-rail" id="platform-gallery">
      <div class="rail-header">
        <div>
          <p class="label">Now streaming</p>
          <h3><%= platformLabel %> highlights</h3>
          <p class="helper-text">
            Hover a card to surface its synopsis above, click to open the full detail modal, or jump to edits.
          </p>
        </div>
        <div class="rail-header__cta">
          <a class="btn btn-secondary" href="<%= catalogLink %>">
            <i class="fa-solid fa-table-cells-large"></i> Open catalog
          </a>
          <a class="btn btn-primary" href="/movies/add">
            <i class="fa-solid fa-plus"></i> Add title
          </a>
        </div>
      </div>

      <% if (platformMovies && platformMovies.length) { %>
        <div class="rail-track" data-movie-rail>
          <% platformMovies.forEach(movie => { %>
            <article class="rail-card" tabindex="0" data-movie-card="<%= movie.title %>" data-movie-card-hover="<%= movie.title %>">
              <div class="rail-card__poster">
                <img src="<%= movie.poster || 'https://placehold.co/240x360/111/eee?text=Poster' %>" alt="<%= movie.title %> poster">
                <span class="rail-card__platform"><%= movie.platform || 'Featured' %></span>
                <div class="rail-card__body">
                  <div class="rail-card__meta">
                    <span>IMDb <strong><%= Number(movie.rating || 0).toFixed(1) %></strong></span>
                    <span><%= movie.runtime || '—' %></span>
                    <span><%= movie.year || '—' %></span>
                  </div>
                  <h4><%= movie.title %></h4>
                  <p>
                    <%= movie.description
                         ? (movie.description.length > 110 ? movie.description.slice(0, 110) + '…' : movie.description)
                         : 'No synopsis yet.' %>
                  </p>
                  <div class="rail-card__tags">
                    <% (movie.genres || []).slice(0, 3).forEach(genre => { %>
                      <span><%= genre %></span>
                    <% }) %>
                  </div>
                  <div class="rail-card__actions">
                    <a class="rail-card__edit" data-rail-edit href="/movies/edit/<%= movie.id %>">
                      <i class="fa-solid fa-pen"></i> Edit metadata
                    </a>
                  </div>
                </div>
              </div>
            </article>
          <% }) %>
        </div>
      <% } else { %>
        <p class="helper-text empty-state">
          No titles in this selection yet. Use the add button above to seed the feed.
        </p>
      <% } %>
    </section>

    <% if (curatedSections.actionPacked && curatedSections.actionPacked.length) { %>
      <section class="category-section">
        <div class="category-header">
          <div>
            <p class="label">Adrenaline rush</p>
            <h3>Action packed sagas</h3>
          </div>
          <a class="category-link" href="/platform/netflix">See all</a>
        </div>
        <div class="category-row">
          <% curatedSections.actionPacked.forEach(movie => { %>
            <article class="category-card" data-movie-card="<%= movie.title %>" data-movie-card-hover="<%= movie.title %>">
              <div class="category-card__art">
                <img src="<%= movie.backdrop || movie.poster || 'https://placehold.co/640x360/111/eee?text=Poster' %>" alt="<%= movie.title %> art">
              </div>
              <div class="category-card__info">
                <p class="category-card__meta"><%= movie.platform || 'Featured' %> • IMDb <strong><%= Number(movie.rating || 0).toFixed(1) %></strong></p>
                <h4><%= movie.title %></h4>
                <p><%= movie.description ? (movie.description.length > 90 ? movie.description.slice(0, 90) + '…' : movie.description) : 'No synopsis yet.' %></p>
              </div>
            </article>
          <% }) %>
        </div>
      </section>
    <% } %>

    <% if (curatedSections.sciFiFrontier && curatedSections.sciFiFrontier.length) { %>
      <section class="category-section">
        <div class="category-header">
          <div>
            <p class="label">Across the cosmos</p>
            <h3>Sci-Fi frontiers</h3>
          </div>
          <a class="category-link" href="/platform/hbo">Explore</a>
        </div>
        <div class="category-row">
          <% curatedSections.sciFiFrontier.forEach(movie => { %>
            <article class="category-card category-card--tall" data-movie-card="<%= movie.title %>" data-movie-card-hover="<%= movie.title %>">
              <div class="category-card__art">
                <img src="<%= movie.backdrop || movie.poster || 'https://placehold.co/640x360/111/eee?text=Poster' %>" alt="<%= movie.title %> art">
              </div>
              <div class="category-card__info">
                <p class="category-card__meta"><%= movie.platform || 'Featured' %> • <%= movie.year || '—' %></p>
                <h4><%= movie.title %></h4>
                <p><%= movie.description ? (movie.description.length > 90 ? movie.description.slice(0, 90) + '…' : movie.description) : 'No synopsis yet.' %></p>
              </div>
            </article>
          <% }) %>
        </div>
      </section>
    <% } %>

    <% if (curatedSections.freshDrops && curatedSections.freshDrops.length) { %>
      <section class="category-section">
        <div class="category-header">
          <div>
            <p class="label">This month</p>
            <h3>Fresh arrivals</h3>
          </div>
          <a class="category-link" href="<%= catalogLink %>">Open catalog</a>
        </div>
        <div class="category-row">
          <% curatedSections.freshDrops.forEach(movie => { %>
            <article class="category-card category-card--compact" data-movie-card="<%= movie.title %>" data-movie-card-hover="<%= movie.title %>">
              <div class="category-card__art">
                <img src="<%= movie.poster || movie.backdrop || 'https://placehold.co/320x480/111/eee?text=Poster' %>" alt="<%= movie.title %> art">
              </div>
              <div class="category-card__info">
                <p class="category-card__meta">IMDb <strong><%= Number(movie.rating || 0).toFixed(1) %></strong> • <%= movie.year || '—' %></p>
                <h4><%= movie.title %></h4>
              </div>
            </article>
          <% }) %>
        </div>
      </section>
    <% } %>

    <% if (curatedSections.dramaClassics && curatedSections.dramaClassics.length) { %>
      <section class="category-section">
        <div class="category-header">
          <div>
            <p class="label">Storytelling legends</p>
            <h3>Drama classics</h3>
          </div>
          <a class="category-link" href="/platform/prime%20video">See library</a>
        </div>
        <div class="category-row">
          <% curatedSections.dramaClassics.forEach(movie => { %>
            <article class="category-card category-card--tall" data-movie-card="<%= movie.title %>" data-movie-card-hover="<%= movie.title %>">
              <div class="category-card__art">
                <img src="<%= movie.backdrop || movie.poster || 'https://placehold.co/640x360/111/eee?text=Poster' %>" alt="<%= movie.title %> art">
              </div>
              <div class="category-card__info">
                <p class="category-card__meta"><%= movie.platform || 'Featured' %> • <%= movie.year || '—' %></p>
                <h4><%= movie.title %></h4>
                <p><%= movie.description ? (movie.description.length > 90 ? movie.description.slice(0, 90) + '…' : movie.description) : 'No synopsis yet.' %></p>
              </div>
            </article>
          <% }) %>
        </div>
      </section>
    <% } %>

    <% if (curatedSections.awardBuzz && curatedSections.awardBuzz.length) { %>
      <section class="category-section">
        <div class="category-header">
          <div>
            <p class="label">Critics’ table</p>
            <h3>Award favorites</h3>
          </div>
          <a class="category-link" href="/admin/films">View insights</a>
        </div>
        <div class="category-row">
          <% curatedSections.awardBuzz.forEach(movie => { %>
            <article class="category-card category-card--wide" data-movie-card="<%= movie.title %>" data-movie-card-hover="<%= movie.title %>">
              <div class="category-card__art">
                <img src="<%= movie.backdrop || movie.poster || 'https://placehold.co/640x360/111/eee?text=Poster' %>" alt="<%= movie.title %> art">
              </div>
              <div class="category-card__info">
                <p class="category-card__meta"><%= movie.platform || 'Featured' %> • <%= movie.year || '—' %></p>
                <h4><%= movie.title %></h4>
                <p><%= movie.description ? (movie.description.length > 70 ? movie.description.slice(0, 70) + '…' : movie.description) : 'No synopsis yet.' %></p>
              </div>
            </article>
          <% }) %>
        </div>
      </section>
    <% } %>
  </section>
</div>

<div id="movieModal" class="modal" role="dialog" aria-modal="true">
  <div class="modal__dialog">
    <button class="modal__close" type="button" data-modal-close>&times;</button>
    <div class="modal__media">
      <img id="modalPoster" src="https://placehold.co/600x800/111/eee?text=Poster" alt="Poster preview">
    </div>
    <div class="modal__body">
      <h2 class="modal__title" id="modalTitle">Movie title</h2>
      <p class="modal__meta" id="modalMeta"></p>
      <p class="modal__description" id="modalDescription"></p>
      <div class="modal__genres" id="modalGenres"></div>
      <p class="helper-text"><strong>Director:</strong> <span id="modalDirector"></span></p>
      <p class="helper-text"><strong>Cast:</strong> <span id="modalCast"></span></p>
      <div class="hero-actions" style="margin-top:1rem;">
        <button class="btn btn-primary" type="button" data-modal-watchlist>Add to watchlist</button>
        <a class="btn btn-secondary" href="#" id="modalTrailerLink" target="_blank" rel="noopener">Watch trailer</a>
      </div>
    </div>
  </div>
</div>

<script>
  window.__CINEVERSE_MOVIES__ = <%- JSON.stringify(movies || {}) %>;
  window.__CINEVERSE_VISIBLE__ = <%- JSON.stringify(visibleMovies || []) %>;
  window.__CINEVERSE_MYLIST__ = <%- JSON.stringify(user && user.myList ? user.myList : []) %>;
  window.__CINEVERSE_USER__ = {
    id: <%- JSON.stringify(user && user._id ? String(user._id) : null) %>,
    isAdmin: <%- JSON.stringify(Boolean(user && user.isAdmin)) %>
  };
  window.__CINEVERSE_PLATFORM__ = <%- JSON.stringify(activePlatform || '') %>;
</script>
