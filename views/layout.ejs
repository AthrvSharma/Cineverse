<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cineverse</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Manrope:wght@400;500;600;700&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="stylesheet" href="/css/app.css">
</head>
<body>
  <div class="app">
    <nav class="top-nav">
      <div class="logo">MOV <span>X</span></div>

      <div class="search-bar">
        <i class="fa-solid fa-magnifying-glass"></i>
        <input type="text" placeholder="Search movie or tv series" data-catalog-search>
      </div>

      <div class="nav-right">
        <button class="nav-icon" type="button" title="Voice search">
          <i class="fa-solid fa-microphone"></i>
        </button>
        <button class="nav-icon" type="button" title="Notifications">
          <i class="fa-regular fa-bell"></i>
        </button>

        <% if (typeof user !== 'undefined' && user) { %>
          <div class="profile">
            <img
              src="<%= user.avatar || 'https://images.unsplash.com/photo-1544723795-3fb6469f5b39?auto=format&fit=crop&w=200&q=60' %>"
              alt="<%= user.name || user.email %> avatar">
            <div class="profile-info">
              <span><%= user.name || user.email %></span>
              <span><a href="/users/logout">Sign out</a></span>
            </div>
            <i class="fa-solid fa-chevron-down"></i>
          </div>
        <% } else { %>
          <a href="/users/login" class="profile guest-profile">
            <img
              src="https://images.unsplash.com/photo-1504593811423-6dd665756598?auto=format&fit=crop&w=200&q=60"
              alt="Guest avatar">
            <div class="profile-info">
              <span>Guest</span>
              <span>Sign in</span>
            </div>
            <i class="fa-solid fa-chevron-right"></i>
          </a>
        <% } %>
      </div>
    </nav>

    <main class="page-body">
      <%- body %>
    </main>

    <div class="search-overlay" data-search-overlay>
      <div class="search-overlay__backdrop" data-search-close></div>
      <div class="search-overlay__panel">
        <div class="search-overlay__header">
          <div>
            <p class="label">Quick find</p>
            <h3>Search across every platform</h3>
            <p class="helper-text">Type a title, actor or genre. Tap a chip for instant filters.</p>
          </div>
          <button class="btn btn-secondary search-overlay__close" type="button" data-search-close>
            <i class="fa-solid fa-xmark"></i> Close
          </button>
        </div>
        <div class="search-overlay__chips" data-search-tags></div>
        <div class="search-overlay__grid" data-search-grid></div>
        <div class="search-overlay__empty" data-search-empty>
          Start typing to surface results from your unlocked platforms.
        </div>
      </div>
    </div>

    <% if (user) { %>
      <div class="ai-launcher" data-ai-launcher>
        <button class="ai-launcher__button" type="button" data-ai-toggle aria-expanded="false">
          <i class="fa-solid fa-robot"></i>
          <span>Ask Lumi</span>
        </button>
        <div class="ai-panel" data-ai-panel>
          <div class="ai-panel__header">
            <div>
              <p class="label">Cineverse AI</p>
              <strong>Lumi concierge</strong>
            </div>
            <button class="ai-close" type="button" data-ai-close aria-label="Close chat">&times;</button>
          </div>
          <div class="ai-feed" data-ai-feed>
            <div class="ai-empty" data-ai-empty>
              Tell Lumi the vibe you're chasing — try "a cozy sci-fi adventure" or "a tense courtroom drama".
            </div>
          </div>
          <div class="ai-status" data-ai-status></div>
          <form class="ai-form" data-ai-form>
            <input type="text" placeholder="Find me an uplifting space opera" autocomplete="off" data-ai-input>
            <button class="ai-send" type="submit">
              <i class="fa-solid fa-paper-plane"></i>
            </button>
          </form>
        </div>
      </div>
    <% } %>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/js/realtime-movies.js"></script>
  <script src="/js/realtime-dashboard.js"></script>
  <script src="/js/catalog-page.js"></script>
  <script src="/js/platform-grid-search.js"></script>
  <script src="/js/ai-assistant.js"></script>
  <script>
    (function () {
      const nodes = document.querySelectorAll('[data-animate]');
      if (!nodes.length) return;
      if (typeof IntersectionObserver === 'undefined') {
        nodes.forEach(node => node.classList.add('is-visible'));
        return;
      }
      const observer = new IntersectionObserver(
        entries => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('is-visible');
              observer.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.2 }
      );
      nodes.forEach(node => observer.observe(node));
    })();
    (function () {
      const params = new URLSearchParams(window.location.search);
      const planSuccess = params.get('planSuccess');
      if (!planSuccess) return;
      const toast = document.createElement('div');
      toast.textContent = `Congratulations — you're now on the ${planSuccess} plan!`;
      toast.style.position = 'fixed';
      toast.style.bottom = '18px';
      toast.style.right = '18px';
      toast.style.padding = '12px 14px';
      toast.style.background = 'rgba(10,12,20,0.9)';
      toast.style.border = '1px solid rgba(110,244,255,0.35)';
      toast.style.borderRadius = '12px';
      toast.style.color = '#fff';
      toast.style.zIndex = '120';
      toast.style.boxShadow = '0 18px 30px rgba(0,0,0,0.6)';
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 4200);
      params.delete('planSuccess');
      const cleanUrl = window.location.pathname + (params.toString() ? '?' + params.toString() : '');
      window.history.replaceState({}, document.title, cleanUrl);
    })();
  </script>
</body>
</html>
